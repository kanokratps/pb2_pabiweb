<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="pb.repo.admin.dao.MainEmployeeBossDAO">
    <resultMap id="result" type="mainEmployeeBossModel">
        <result property="costCenter" column="cost_center"/>
        <result property="level" column="level"/>
        <result property="bossIds" column="boss_ids"/>
        <result property="totalRowCount" column="totalRowCount"/>
        
    </resultMap>
    
    <insert
		id="add"
		parameterType="mainEmployeeBossModel"
		flushCache="true"
		statementType="PREPARED"
		keyProperty="user"
		useGeneratedKeys="true"
		>
	    insert into pb2_ext_employee_boss(cost_center,level,boss_ids)
    	values (#{costCenter},#{level},#{bossIds})
		
	</insert>
	
	<select id="count"  resultType="long">
        select
		    count(1)
		from
		    pb2_ext_employee_boss
	
    </select>
	
	<delete id="delete"
    		parameterType="mainEmployeeBossModel"
			flushCache="true"
			statementType="PREPARED"
			>
   		delete from pb2_ext_employee_boss where cost_center=#{costCenter} and level=#{level}
	</delete>
	
	<select id="listBoss" parameterType="map" resultType="map">
		select b.level,b.boss_ids,l.from_amount,l.to_amount 
		from pb2_ext_costcenter_org_rel c 
		left join pb2_ext_employee_level l on l.org=c.org
		left join pb2_ext_employee_boss b on c.cost_center=b.cost_center and l.level=b.level
 		where c.cost_center=#{costCenter}
		and module like '%'||#{bossModule}||'%'
		and b.level is not null
		order by l.level
    </select>
	
</mapper>
